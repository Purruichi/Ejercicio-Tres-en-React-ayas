{"ast":null,"code":"import{useState,useEffect}from\"react\";import{getBoard,reloadBoard,createGame,getWinner,turno,joinGame}from\"./Api\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Board(){const[xIsNext,setXIsNext]=useState(true);const[squares,setSquares]=useState(getBoard()||Array(9).fill(null));const[winner,setWinner]=useState(null);const[isPolling,setIsPolling]=useState(true);// Nuevo estado para controlar el polling\nuseEffect(()=>{if(!isPolling)return;// Si no estamos haciendo polling, no hacemos nada\nconst interval=setInterval(()=>{reloadBoard().then(()=>{const newBoard=getBoard();if(JSON.stringify(squares)!==JSON.stringify(newBoard)){setSquares(newBoard||Array(9).fill(null));setIsPolling(false);// Detenemos el polling si hay cambios\n}});const currentWinner=getWinner();if(currentWinner){setWinner(currentWinner);setIsPolling(false);// Detenemos el polling si hay un ganador\n}},5000);// Cleanup del intervalo al desmontar el componente\nreturn()=>clearInterval(interval);},[squares,isPolling]);// Dependencias en `squares` y `isPolling`\nfunction handleClick(i){if(squares[i]||winner)return;turno(i).then(()=>{setSquares(getBoard()||Array(9).fill(\"Err\"));setWinner(getWinner());setXIsNext(!xIsNext);setIsPolling(true);// Reiniciamos el polling después de un movimiento\n});}function handleNewGame(){createGame();setSquares(getBoard()||Array(9).fill(null));setWinner(null);setIsPolling(true);// Reiniciamos el polling para la nueva partida\n}function handleJoinGame(){joinGame().then(()=>{console.log(\"Unido al juego\");setSquares(getBoard()||Array(9).fill(null));setWinner(null);setIsPolling(true);// Reiniciamos el polling al unirnos a un juego\n}).catch(error=>{console.error(\"Error al unirse al juego:\",error);});}useEffect(()=>{const newGameButton=document.getElementById(\"newGame\");const joinGameButton=document.getElementById(\"joinGame\");if(newGameButton){newGameButton.addEventListener(\"click\",handleNewGame);}if(joinGameButton){joinGameButton.addEventListener(\"click\",handleJoinGame);}return()=>{if(newGameButton){newGameButton.removeEventListener(\"click\",handleNewGame);}if(joinGameButton){joinGameButton.removeEventListener(\"click\",handleJoinGame);}};},[]);let status=winner?`Ganador: ${winner}!`:`Siguiente jugador: ${xIsNext?\"X\":\"O\"}`;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"status\",children:status}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-row\",children:[/*#__PURE__*/_jsx(Square,{value:squares[0],onSquareClick:()=>handleClick(0)}),/*#__PURE__*/_jsx(Square,{value:squares[1],onSquareClick:()=>handleClick(1)}),/*#__PURE__*/_jsx(Square,{value:squares[2],onSquareClick:()=>handleClick(2)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-row\",children:[/*#__PURE__*/_jsx(Square,{value:squares[3],onSquareClick:()=>handleClick(3)}),/*#__PURE__*/_jsx(Square,{value:squares[4],onSquareClick:()=>handleClick(4)}),/*#__PURE__*/_jsx(Square,{value:squares[5],onSquareClick:()=>handleClick(5)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-row\",children:[/*#__PURE__*/_jsx(Square,{value:squares[6],onSquareClick:()=>handleClick(6)}),/*#__PURE__*/_jsx(Square,{value:squares[7],onSquareClick:()=>handleClick(7)}),/*#__PURE__*/_jsx(Square,{value:squares[8],onSquareClick:()=>handleClick(8)})]})]});}function Square(_ref){let{value,onSquareClick}=_ref;return/*#__PURE__*/_jsx(\"button\",{className:\"square\",onClick:onSquareClick,children:value});}","map":{"version":3,"names":["useState","useEffect","getBoard","reloadBoard","createGame","getWinner","turno","joinGame","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Board","xIsNext","setXIsNext","squares","setSquares","Array","fill","winner","setWinner","isPolling","setIsPolling","interval","setInterval","then","newBoard","JSON","stringify","currentWinner","clearInterval","handleClick","i","handleNewGame","handleJoinGame","console","log","catch","error","newGameButton","document","getElementById","joinGameButton","addEventListener","removeEventListener","status","children","className","Square","value","onSquareClick","_ref","onClick"],"sources":["C:/Users/purru/OneDrive - Universidad Pontificia Comillas/Documentos/3_Tercero/PAT/Repositorios/practica4/Ejercicio Tres en React-ayas/src/App.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { getBoard, reloadBoard, createGame, getWinner, turno, joinGame } from \"./Api\";\n\nexport default function Board() {\n  const [xIsNext, setXIsNext] = useState(true);\n  const [squares, setSquares] = useState(getBoard() || Array(9).fill(null));\n  const [winner, setWinner] = useState(null);\n  const [isPolling, setIsPolling] = useState(true); // Nuevo estado para controlar el polling\n\n  useEffect(() => {\n    if (!isPolling) return; // Si no estamos haciendo polling, no hacemos nada\n\n    const interval = setInterval(() => {\n      reloadBoard().then(() => {\n        const newBoard = getBoard();\n        if (JSON.stringify(squares) !== JSON.stringify(newBoard)) {\n          setSquares(newBoard || Array(9).fill(null));\n          setIsPolling(false); // Detenemos el polling si hay cambios\n        }\n      });\n\n      const currentWinner = getWinner();\n      if (currentWinner) {\n        setWinner(currentWinner);\n        setIsPolling(false); // Detenemos el polling si hay un ganador\n      }\n    }, 5000);\n\n    // Cleanup del intervalo al desmontar el componente\n    return () => clearInterval(interval);\n  }, [squares, isPolling]); // Dependencias en `squares` y `isPolling`\n\n  function handleClick(i) {\n    if (squares[i] || winner) return;\n\n    turno(i).then(() => {\n      setSquares(getBoard() || Array(9).fill(\"Err\"));\n      setWinner(getWinner());\n      setXIsNext(!xIsNext);\n      setIsPolling(true); // Reiniciamos el polling después de un movimiento\n    });\n  }\n\n  function handleNewGame() {\n    createGame();\n    setSquares(getBoard() || Array(9).fill(null));\n    setWinner(null);\n    setIsPolling(true); // Reiniciamos el polling para la nueva partida\n  }\n\n  function handleJoinGame() {\n    joinGame()\n      .then(() => {\n        console.log(\"Unido al juego\");\n        setSquares(getBoard() || Array(9).fill(null));\n        setWinner(null);\n        setIsPolling(true); // Reiniciamos el polling al unirnos a un juego\n      })\n      .catch((error) => {\n        console.error(\"Error al unirse al juego:\", error);\n      });\n  }\n\n  useEffect(() => {\n    const newGameButton = document.getElementById(\"newGame\");\n    const joinGameButton = document.getElementById(\"joinGame\");\n\n    if (newGameButton) {\n      newGameButton.addEventListener(\"click\", handleNewGame);\n    }\n\n    if (joinGameButton) {\n      joinGameButton.addEventListener(\"click\", handleJoinGame);\n    }\n\n    return () => {\n      if (newGameButton) {\n        newGameButton.removeEventListener(\"click\", handleNewGame);\n      }\n      if (joinGameButton) {\n        joinGameButton.removeEventListener(\"click\", handleJoinGame);\n      }\n    };\n  }, []);\n\n  let status = winner ? `Ganador: ${winner}!` : `Siguiente jugador: ${xIsNext ? \"X\" : \"O\"}`;\n\n  return (\n    <>\n      <div className=\"status\">{status}</div>\n      <div className=\"board-row\">\n        <Square value={squares[0]} onSquareClick={() => handleClick(0)} />\n        <Square value={squares[1]} onSquareClick={() => handleClick(1)} />\n        <Square value={squares[2]} onSquareClick={() => handleClick(2)} />\n      </div>\n      <div className=\"board-row\">\n        <Square value={squares[3]} onSquareClick={() => handleClick(3)} />\n        <Square value={squares[4]} onSquareClick={() => handleClick(4)} />\n        <Square value={squares[5]} onSquareClick={() => handleClick(5)} />\n      </div>\n      <div className=\"board-row\">\n        <Square value={squares[6]} onSquareClick={() => handleClick(6)} />\n        <Square value={squares[7]} onSquareClick={() => handleClick(7)} />\n        <Square value={squares[8]} onSquareClick={() => handleClick(8)} />\n      </div>\n    </>\n  );\n}\n\nfunction Square({ value, onSquareClick }) {\n  return (\n    <button className=\"square\" onClick={onSquareClick}>\n      {value}\n    </button>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}